var U=Object.defineProperty;var R=Object.getOwnPropertySymbols;var $=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var P=i=>{throw TypeError(i)};var v=(i,e,t)=>e in i?U(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,C=(i,e)=>{for(var t in e||(e={}))$.call(e,t)&&v(i,t,e[t]);if(R)for(var t of R(e))j.call(e,t)&&v(i,t,e[t]);return i};var M=(i,e,t)=>e.has(i)||P("Cannot "+t);var n=(i,e,t)=>(M(i,e,"read from private field"),t?t.call(i):e.get(i)),m=(i,e,t)=>e.has(i)?P("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),d=(i,e,t,r)=>(M(i,e,"write to private field"),r?r.call(i,t):e.set(i,t),t);var l=(i,e,t)=>new Promise((r,c)=>{var s=u=>{try{f(t.next(u))}catch(y){c(y)}},h=u=>{try{f(t.throw(u))}catch(y){c(y)}},f=u=>u.done?r(u.value):Promise.resolve(u.value).then(s,h);f((t=t.apply(i,e)).next())});import{v4 as _}from"uuid";import{ofetch as K}from"ofetch";function a(i,e,t={}){return i.auth.accessToken&&(t.headers=C({Authorization:`Bearer ${i.auth.accessToken}`},t.headers)),K(e,C({baseURL:i.config.apiBaseUrl},t))}function D(){var i,e;return(e=(i=document.querySelector('link[rel="icon"]'))==null?void 0:i.href)!=null?e:null}function O(){var i;return(i=document.title)!=null?i:null}function I(i,e,t=localStorage){let r=t.getItem(i),c=e?JSON.stringify(e):null;c?t.setItem(i,c):t.removeItem(i),window.dispatchEvent(new StorageEvent("storage",{key:i,oldValue:r,newValue:c,storageArea:t}))}function A(i,e=localStorage){let t=e.getItem(i);try{return t?JSON.parse(t):null}catch(r){return null}}var g,T,E=class{constructor(e){m(this,g);m(this,T,`lumi-auth-${_()}`);d(this,g,e)}get accessToken(){return A("lumi-access-token")}set accessToken(e){I("lumi-access-token",e)}get user(){return A("lumi-user")}set user(e){I("lumi-user",e)}get isAuthenticated(){return!!this.accessToken}signIn(){let r=(window.screen.width-800)/2,c=(window.screen.height-600)/2,s=window.open(n(this,g).config.authOrigin,n(this,T),`width=800,height=600,left=${r},top=${c}`),h;return new Promise((f,u)=>{if(!s)return u(new Error("Open auth window failed"));let y=setInterval(()=>{s.closed&&u(new Error("Auth window closed"))},1e3),L=({data:p,origin:k,source:N})=>{if(!(k!==n(this,g).config.authOrigin||N!==s))switch(p==null?void 0:p.type){case"lumi-ready":{s.postMessage({type:"lumi-init",data:{projectId:n(this,g).config.projectId,icon:D(),title:O()}},n(this,g).config.authOrigin);break}case"lumi-sign-in":{if(p.data.projectId!==n(this,g).config.projectId)break;s.close(),window.focus(),this.accessToken=p.data.accessToken,this.user=p.data.user,f(p.data);break}}};window.addEventListener("message",L),h=()=>{clearInterval(y),window.removeEventListener("message",L)}}).finally(()=>h==null?void 0:h())}signOut(){this.accessToken=null,this.user=null}refreshUser(){return l(this,null,function*(){let e=yield a(n(this,g),"/lm/user/info",{method:"POST"});if(e.code!==200)throw new Error(e.message);return this.user=e.data,e.data})}onAuthChange(e){let t=r=>{(r.key==="lumi-access-token"||r.key==="lumi-user"||r.key===null)&&e({isAuthenticated:this.isAuthenticated,user:this.user})};return window.addEventListener("storage",t),()=>{window.removeEventListener("storage",t)}}};g=new WeakMap,T=new WeakMap;var o,b=class{constructor(e,t){m(this,o);d(this,o,e),this.entityName=t}list(){return l(this,arguments,function*({filter:e,sort:t,limit:r,skip:c}={}){if(r){let s=yield a(n(this,o),this.uri("/find"),{method:"POST",body:{filter:e,sort:t,limit:r,skip:c}});if(s.code!==200)throw new Error(s.message);return s.data}else{let s=yield a(n(this,o),this.uri("/list"),{method:"POST",body:{filter:e,sort:t}});if(s.code!==200)throw new Error(s.message);return{total:s.data.length,list:s.data}}})}get(e){return l(this,null,function*(){let t=yield a(n(this,o),this.uri(`/${e}`),{method:"GET"});if(t.code!==200)throw new Error(t.message);return t.data})}create(e){return l(this,null,function*(){let t=yield a(n(this,o),this.uri(),{method:"POST",body:e});if(t.code!==200)throw new Error(t.message);return t.data})}createMany(e){return l(this,null,function*(){let t=yield a(n(this,o),this.uri("/batch"),{method:"POST",body:e});if(t.code!==200)throw new Error(t.message);return t.data})}update(e,t){return l(this,null,function*(){let r=yield a(n(this,o),this.uri(),{method:"PUT",body:{filter:{_id:e},update:t}});if(r.code!==200)throw new Error(r.message);return r.data})}delete(e){return l(this,null,function*(){let t=yield a(n(this,o),this.uri(`/${e}`),{method:"DELETE"});if(t.code!==200)throw new Error(t.message)})}deleteMany(e){return l(this,null,function*(){let t=yield a(n(this,o),this.uri("/batch-by-ids"),{method:"DELETE",params:{ids:e}});if(t.code!==200)throw new Error(t.message)})}uri(e=""){return`/lm/${n(this,o).config.projectId}/${this.entityName}/documents${e}`}};o=new WeakMap;var w,S=class{constructor(e){m(this,w);return d(this,w,e),new Proxy(this,{get(t,r){return r in t||(t[r]=new b(n(t,w),r)),t[r]}})}};w=new WeakMap;var x=class{constructor(e){this.config=e,this.auth=new E(this),this.entities=new S(this)}};function ae(i){return new x(i)}export{S as EntitiesClient,b as EntityClient,E as LumiAuthClient,x as LumiClient,ae as createClient};
//# sourceMappingURL=index.mjs.map